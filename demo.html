<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CaloriePilot Pro - å¤–å–çƒ­é‡è¿½è¸ª MVP</title>
  <style>
    :root {
      --bg: #f3f6ff; --surface: #fff; --surface-soft: #f8faff; --text: #111827; --muted: #6b7280;
      --line: #e6eaf2; --primary: #335dff; --primary-2: #6b87ff; --success: #16a34a; --warning: #f59e0b;
      --danger: #ef4444; --shadow: 0 12px 30px rgba(22,35,90,.08);
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, "PingFang SC", "Microsoft YaHei", sans-serif; color:var(--text);
      background: radial-gradient(1200px 600px at 20% -10%, #dee8ff 0%, var(--bg) 45%, #eef2ff 100%); }
    .layout { max-width:1180px; margin:0 auto; padding:28px 20px 120px; display:grid; grid-template-columns:1.1fr .9fr; gap:20px; }
    .panel { background:var(--surface); border:1px solid var(--line); border-radius:20px; box-shadow:var(--shadow); overflow:hidden; }
    .hero { padding:28px; background:linear-gradient(135deg,#2138a6,#335dff 35%,#6b87ff); color:#fff; }
    .hero h1 { margin:0; font-size:30px; } .hero p { margin:10px 0 0; opacity:.95; line-height:1.6; }
    .tag { display:inline-flex; gap:6px; font-size:12px; border-radius:999px; background:rgba(255,255,255,.16); padding:6px 12px; margin-bottom:12px; }
    .content { padding:20px; }
    .kpis { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:14px; }
    .kpi { border:1px solid var(--line); background:var(--surface-soft); border-radius:14px; padding:12px; }
    .kpi .label { font-size:12px; color:var(--muted); } .kpi .value { margin-top:6px; font-weight:700; font-size:20px; }

    .phone { width:100%; max-width:390px; margin:0 auto; border-radius:28px; background:#fff; border:1px solid #dce3f3;
      box-shadow:0 18px 40px rgba(40,54,119,.18); overflow:hidden; position:relative; }
    .statusbar { height:26px; background:#f8fbff; border-bottom:1px solid var(--line); }
    .screen { height:760px; overflow:auto; padding:16px 14px 86px; background:#f6f9ff; display:none; }
    .screen.active { display:block; }
    .h-title { font-size:22px; font-weight:800; margin:0 0 2px; } .h-sub { color:var(--muted); font-size:12px; margin-bottom:14px; }
    .card { border:1px solid var(--line); background:#fff; border-radius:16px; padding:14px; margin-bottom:10px; }
    .split { display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .ring { width:94px; height:94px; border-radius:50%; background:conic-gradient(var(--primary) 0 72%, #e9edff 72% 100%); position:relative; }
    .ring::after { content:attr(data-progress); position:absolute; inset:11px; border-radius:50%; background:#fff; display:grid; place-items:center; font-size:14px; font-weight:700; color:var(--primary); }
    .btn { width:100%; border:0; border-radius:12px; padding:12px 14px; font-weight:700; cursor:pointer; }
    .btn.primary { background:linear-gradient(135deg,var(--primary),var(--primary-2)); color:#fff; }
    .btn.secondary { background:#fff; border:1px solid var(--line); color:var(--text); }
    .btn.ghost { background:#eef2ff; color:#2a4fff; }
    .row { display:flex; gap:8px; }
    .pill { font-size:11px; border-radius:999px; padding:4px 10px; display:inline-block; }
    .pill.warn { background:#fff7ed; color:#9a3412; } .pill.danger { background:#fef2f2; color:#991b1b; } .pill.ok { background:#ecfdf3; color:#166534; }
    .meal { border:1px solid var(--line); border-radius:12px; padding:10px; margin-top:8px; background:linear-gradient(180deg,#fff,#fbfcff); }
    .tiny { font-size:12px; color:var(--muted); }

    .seg { display:flex; gap:6px; margin-top:8px; flex-wrap:wrap; }
    .seg button { flex:1; min-width:68px; border:1px solid var(--line); background:#fff; border-radius:10px; padding:8px 0; cursor:pointer; }
    .seg button.active { border-color:#b8c7ff; background:#edf2ff; color:#2a4fff; font-weight:700; }
    .input, .select, textarea { width:100%; padding:10px; border:1px solid var(--line); border-radius:10px; background:#fff; font-size:14px; }

    .timeline { display:flex; align-items:end; gap:6px; height:94px; margin-top:8px; }
    .bar { width:18px; border-radius:6px 6px 0 0; background:#c7d2fe; position:relative; }
    .bar span { position:absolute; bottom:-18px; width:18px; left:0; font-size:10px; color:var(--muted); text-align:center; }
    .bar.ok { background:#86efac; } .bar.warn { background:#fcd34d; } .bar.danger { background:#fca5a5; }

    .tabbar { position:absolute; left:0; right:0; bottom:0; border-top:1px solid var(--line); background:rgba(255,255,255,.96); display:flex; }
    .tab { flex:1; text-align:center; padding:10px 0; color:var(--muted); font-size:12px; cursor:pointer; }
    .tab.active { color:var(--primary); font-weight:700; }

    .modal { position:fixed; inset:0; background:rgba(15,23,42,.45); display:none; align-items:center; justify-content:center; z-index:30; padding:20px; }
    .modal.show { display:flex; }
    .modal-card { width:min(420px,100%); background:#fff; border-radius:18px; padding:18px; box-shadow:0 20px 40px rgba(0,0,0,.24); }
    .loader { margin:12px auto; width:44px; height:44px; border-radius:50%; border:4px solid #e5e7eb; border-top-color:var(--primary); animation:spin .9s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .meta { font-size:12px; color:var(--muted); margin-top:6px; }
    .hidden { display:none; }

    @media (max-width:980px) { .layout { grid-template-columns:1fr; } .kpis { grid-template-columns:1fr 1fr; } }
  </style>
</head>
<body>
  <main class="layout">
    <section class="panel">
      <div class="hero">
        <span class="tag">ğŸš€ å•†ä¸šçº§äº§å“ Demo / å‰ç«¯ç‹¬ç«‹æ¼”ç¤º</span>
        <h1>CaloriePilot Pro</h1>
        <p>ä¸ºéƒ½å¸‚ç™½é¢†æ‰“é€ çš„å¤–å–çƒ­é‡è¿½è¸ªåŠ©æ‰‹ï¼šæ‹ç…§è¯†åˆ«ã€çƒ­é‡è¯„ä¼°ã€é£é™©æç¤ºã€ä¸‹ä¸€é¤ç­–ç•¥ä¸å‘¨è¶‹åŠ¿å¤ç›˜ã€‚</p>
      </div>
      <div class="content">
        <div class="kpis">
          <div class="kpi"><div class="label">å‘¨è®°å½•ç”¨æˆ·</div><div class="value" id="kpiUsers">1,284</div></div>
          <div class="kpi"><div class="label">è¯†åˆ«è€—æ—¶ P95</div><div class="value">8.3s</div></div>
          <div class="kpi"><div class="label">å»ºè®®é‡‡çº³ç‡</div><div class="value" id="kpiAdvice">47%</div></div>
        </div>
        <div class="card">
          <div class="split"><b>æ¼”ç¤ºè¯´æ˜</b><span class="tiny">æ— åç«¯ Â· æœ¬åœ°æŒä¹…åŒ–</span></div>
          <p class="tiny" style="margin:8px 0 0;line-height:1.6">ç°åœ¨å¯ä»¥æŒç»­è®°å½•ï¼šä¿å­˜åå°†å†™å…¥æœ¬åœ°å­˜å‚¨ï¼Œé¦–é¡µâ€œæœ€è¿‘è®°å½•â€å’Œåˆ†æé¡µâ€œ7æ—¥è¶‹åŠ¿â€ä¼šå®æ—¶æ›´æ–°ã€‚</p>
        </div>
      </div>
    </section>

    <section class="phone" aria-label="mobile-demo">
      <div class="statusbar"></div>

      <section id="home" class="screen active">
        <h2 class="h-title">è®°å½•</h2>
        <div class="h-sub" id="homeGreeting">ä»Šå¤©å…ˆä»åˆé¤å¼€å§‹ï¼Œæ§çƒ­é‡ä¸æŒ¨é¥¿</div>
        <div class="card split">
          <div>
            <div class="tiny">ä»Šæ—¥æ‘„å…¥</div>
            <div style="font-size:26px;font-weight:800" id="calorieTotal">0 / 1800 kcal</div>
            <div class="tiny" id="calorieState">ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•ï¼Œå…ˆæ‹ç¬¬ä¸€é¤å§</div>
          </div>
          <div class="ring" id="ring" data-progress="0%"></div>
        </div>
        <button class="btn primary" onclick="showScreen('upload')">ğŸ“· æ‹ç…§è®°å½•ä¸€é¤</button>

        <div class="card" style="margin-top:10px">
          <div class="split"><b>æœ€è¿‘è®°å½•</b><span class="tiny" id="recentCount">0 æ¡</span></div>
          <div id="recentList" class="tiny">æš‚æ— è®°å½•</div>
        </div>
      </section>

      <section id="upload" class="screen">
        <h2 class="h-title">ä¸Šä¼ é¤é£Ÿ</h2>
        <div class="h-sub">æ”¯æŒå•å¼ å›¾ç‰‡è¯†åˆ«ï¼ˆDemo ä¸ä¸Šä¼ äº‘ç«¯ï¼‰</div>
        <div class="card">
          <label class="tiny">é¤é£Ÿç…§ç‰‡</label>
          <input id="photo" class="input" type="file" accept="image/*" />
          <label class="tiny" style="display:block;margin-top:8px">é¤æ¬¡</label>
          <div class="seg" id="mealSeg">
            <button data-meal="æ—©é¤">æ—©é¤</button>
            <button class="active" data-meal="åˆé¤">åˆé¤</button>
            <button data-meal="æ™šé¤">æ™šé¤</button>
            <button data-meal="åŠ é¤">åŠ é¤</button>
          </div>
          <label class="tiny" style="display:block;margin-top:8px">é¤é£Ÿæè¿°ï¼ˆå¯é€‰ï¼‰</label>
          <textarea id="mealDesc" rows="2" placeholder="ä¾‹å¦‚ï¼šé»„ç„–é¸¡ç±³é¥­ + åŠç³–å¥¶èŒ¶"></textarea>
          <div class="meta" id="uploadMeta">å½“å‰ä»¥ã€Œåˆé¤ã€ç­–ç•¥ç”Ÿæˆå»ºè®®ã€‚</div>
        </div>
        <div class="row">
          <button class="btn secondary" onclick="showScreen('home')">è¿”å›</button>
          <button class="btn primary" onclick="startRecognition()">å¼€å§‹è¯†åˆ«</button>
        </div>
      </section>

      <section id="result" class="screen">
        <h2 class="h-title">è¯†åˆ«ç»“æœ</h2>
        <div class="h-sub">AI è¯„ä¼°ï¼ˆæ¨¡æ‹Ÿï¼‰</div>
        <div class="card">
          <div class="tiny">çƒ­é‡åŒºé—´</div>
          <div style="font-size:30px;font-weight:800" id="resultCalorie">650 - 820 kcal</div>
          <div style="margin-top:4px" id="riskTags"></div>
          <div class="meta" style="margin-top:8px" id="resultBreakdown">ä¸»è¦æ¥æºï¼šä¸»é£Ÿ 35% / æ²¹è„‚ 30% / è›‹ç™½ 25% / é¥®æ–™ 10%</div>
        </div>
        <div class="card"><b>ä¸‹ä¸€é¤å»ºè®®</b><div class="tiny" id="advice1" style="margin-top:6px"></div></div>
        <div class="card"><b>ä»Šæ—¥è¡¥æ•‘å»ºè®®</b><div class="tiny" id="advice2" style="margin-top:6px"></div></div>
        <div class="row">
          <button class="btn ghost" onclick="shuffleAdvice()">æ¢ä¸€ç»„å»ºè®®</button>
          <button class="btn primary" onclick="saveLog()">ä¿å­˜è®°å½•</button>
        </div>
      </section>

      <section id="analysis" class="screen">
        <h2 class="h-title">åˆ†æ</h2>
        <div class="h-sub">è¿‘ 7 æ—¥æ‘„å…¥è¶‹åŠ¿ä¸é£é™©åˆ†å¸ƒ</div>
        <div class="card">
          <div class="split"><b>è¶‹åŠ¿å›¾</b><span class="tiny">kcal</span></div>
          <div class="timeline" id="weekChart"></div>
          <div class="meta" id="weekSummary">æœ€è¿‘ 7 å¤©æš‚æ— è®°å½•ã€‚</div>
        </div>
        <div class="card"><b>é«˜é£é™©é¤æ¬¡æé†’</b><div class="tiny" style="margin-top:6px" id="riskSummary">æš‚æ— é«˜é£é™©é¤æ¬¡ã€‚</div></div>
      </section>

      <section id="profile" class="screen">
        <h2 class="h-title">æˆ‘çš„</h2>
        <div class="h-sub">ä¸ªæ€§åŒ–ç›®æ ‡ä¸è®¢é˜…æƒç›Š</div>
        <div class="card">
          <b>åŸºç¡€æ¡£æ¡ˆ</b>
          <div class="tiny" style="margin-top:8px" id="profileText">ç›®æ ‡ï¼šå‡è„‚ | èº«é«˜ï¼š172cm | ä½“é‡ï¼š68kg | æ´»åŠ¨ï¼šä¸­ç­‰</div>
          <button class="btn secondary" style="margin-top:10px" onclick="toggleProfileForm()">ç¼–è¾‘æ¡£æ¡ˆ</button>
          <div id="profileForm" class="hidden" style="margin-top:10px">
            <div class="row"><input id="pHeight" class="input" type="number" placeholder="èº«é«˜ cm" /><input id="pWeight" class="input" type="number" placeholder="ä½“é‡ kg" /></div>
            <div class="row" style="margin-top:8px"><select id="pGoal" class="select"><option>å‡è„‚</option><option>ç»´æŒ</option><option>å¢è‚Œ</option></select><select id="pActive" class="select"><option>ä½</option><option selected>ä¸­ç­‰</option><option>é«˜</option></select></div>
            <button class="btn primary" style="margin-top:8px" onclick="saveProfile()">ä¿å­˜æ¡£æ¡ˆ</button>
          </div>
        </div>
        <div class="card"><b>ä¼šå‘˜æƒç›Šï¼ˆDemoï¼‰</b><div class="tiny" style="margin-top:8px;line-height:1.7">ä¸é™æ¬¡è¯†åˆ« Â· æ¯å‘¨å¤ç›˜æŠ¥å‘Š Â· é¥®é£Ÿç­–ç•¥åŒ… Â· AI è¥å…»é—®ç­”</div></div>
      </section>

      <nav class="tabbar">
        <div class="tab active" data-target="home">è®°å½•</div>
        <div class="tab" data-target="analysis">åˆ†æ</div>
        <div class="tab" data-target="profile">æˆ‘çš„</div>
      </nav>
    </section>
  </main>

  <div class="modal" id="modal"><div class="modal-card"><h3 style="margin:0">æ­£åœ¨è¯†åˆ«é¤é£Ÿ...</h3><div class="loader"></div><div class="tiny" id="loadingText">æ­£åœ¨åˆ†æä¸»é£Ÿã€è›‹ç™½ã€æ²¹è„‚å æ¯”</div></div></div>

  <script>
    const storageKey = 'caloriepilot-pro-v1';
    const adviceSet = [
      ['ä¸‹ä¸€é¤ï¼šä¸»é£Ÿæ§åˆ¶åœ¨ 1/2 ä»½ï¼Œä¼˜å…ˆé€‰æ‹©æ¸…è’¸è›‹ç™½ã€‚', 'ä»Šæ—¥è¡¥æ•‘ï¼šå¢åŠ  2500 æ­¥ï¼Œæ™šé¤é¿å…é«˜ç³–é¥®å“ã€‚'],
      ['ä¸‹ä¸€é¤ï¼šåŠ  1 ä»½è”¬èœå’Œ 1 ä»½ä¼˜è´¨è›‹ç™½ï¼Œå‡å°‘é‡æ²¹é…±æ±ã€‚', 'ä»Šæ—¥è¡¥æ•‘ï¼šå¤œé—´ä¸åŠ é¤ï¼Œè¡¥å……æ— ç³–é…¸å¥¶æˆ–é»„ç“œã€‚'],
      ['ä¸‹ä¸€é¤ï¼šå°†ç²¾åˆ¶ä¸»é£Ÿæ›¿æ¢ä¸ºç‰ç±³/çº¢è–¯ï¼Œå‡å°‘é’ æ‘„å…¥ã€‚', 'ä»Šæ—¥è¡¥æ•‘ï¼šæ™šé¥­å 20 åˆ†é’Ÿè½»è¿åŠ¨ï¼Œæ—©ç¡å‡å°‘ä»£è°¢å‹åŠ›ã€‚']
    ];
    const mealBase = { æ—©é¤: [350, 520], åˆé¤: [620, 850], æ™šé¤: [520, 760], åŠ é¤: [180, 360] };

    const state = {
      selectedMeal: 'åˆé¤',
      currentResult: null,
      profile: { goal: 'å‡è„‚', height: 172, weight: 68, activity: 'ä¸­ç­‰', dailyGoal: 1800 },
      logs: []
    };

    function todayStr() { return new Date().toISOString().slice(0, 10); }
    function weekDays() {
      return [...Array(7)].map((_, i) => {
        const d = new Date(); d.setDate(d.getDate() - (6 - i));
        return d.toISOString().slice(5, 10);
      });
    }

    function saveState() { localStorage.setItem(storageKey, JSON.stringify({ profile: state.profile, logs: state.logs })); }
    function loadState() {
      const raw = localStorage.getItem(storageKey); if (!raw) return;
      try {
        const data = JSON.parse(raw);
        if (data.profile) state.profile = { ...state.profile, ...data.profile };
        if (Array.isArray(data.logs)) state.logs = data.logs;
      } catch (_) {}
    }

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.toggle('active', s.id === id));
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.target === id));
      if (id === 'analysis') renderAnalysis();
      if (id === 'home') renderHome();
      if (id === 'profile') renderProfile();
    }

    function mealColor(risk) {
      if (risk.includes('é«˜ç³–') || risk.includes('é«˜æ²¹')) return 'danger';
      if (risk.includes('é«˜é’ ')) return 'warn';
      return 'ok';
    }

    function renderHome() {
      const today = todayStr();
      const todayLogs = state.logs.filter(x => x.date === today);
      const total = todayLogs.reduce((s, x) => s + x.calorieMid, 0);
      const goal = state.profile.dailyGoal;
      const pct = Math.min(100, Math.round((total / goal) * 100));
      const ring = document.getElementById('ring');
      ring.style.background = `conic-gradient(#335dff 0 ${pct}%, #e9edff ${pct}% 100%)`;
      ring.setAttribute('data-progress', `${pct}%`);
      document.getElementById('calorieTotal').textContent = `${total} / ${goal} kcal`;
      document.getElementById('calorieState').textContent = total === 0 ? 'ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•ï¼Œå…ˆæ‹ç¬¬ä¸€é¤å§' : (total > goal ? 'å·²è¶…æ ‡ï¼Œå»ºè®®æ™šé¤ä½è„‚ä½ç³–' : total > goal * 0.85 ? 'æ¥è¿‘ä¸Šé™ï¼Œæ³¨æ„æ™šé¤æ§åˆ¶' : 'çŠ¶æ€è‰¯å¥½ï¼Œç»§ç»­ä¿æŒ');
      const recent = [...state.logs].sort((a,b)=>b.ts-a.ts).slice(0,3);
      document.getElementById('recentCount').textContent = `${recent.length} æ¡`;
      document.getElementById('recentList').innerHTML = recent.length ? recent.map(x => `<div class="meal"><b>${x.meal} Â· ${x.name}</b><div class="tiny">${x.calorieMin}-${x.calorieMax} kcal Â· <span class="pill ${mealColor(x.risks)}">${x.risks.join(' / ')}</span></div></div>`).join('') : 'æš‚æ— è®°å½•';
      document.getElementById('kpiAdvice').textContent = `${Math.min(88, 35 + state.logs.length * 2)}%`;
    }

    function renderAnalysis() {
      const labels = weekDays();
      const byDay = Object.fromEntries(labels.map(d => [d, 0]));
      state.logs.forEach(x => {
        const k = x.date.slice(5, 10);
        if (k in byDay) byDay[k] += x.calorieMid;
      });
      const max = Math.max(1, ...Object.values(byDay));
      const chart = document.getElementById('weekChart');
      chart.innerHTML = labels.map(d => {
        const v = byDay[d];
        const h = Math.max(10, Math.round((v / max) * 84));
        const cls = v > state.profile.dailyGoal ? 'danger' : v > state.profile.dailyGoal * 0.85 ? 'warn' : 'ok';
        return `<div class="bar ${cls}" style="height:${h}px"><span>${d.split('-')[1]}</span></div>`;
      }).join('');
      const weekTotal = Object.values(byDay).reduce((a,b)=>a+b,0);
      document.getElementById('weekSummary').textContent = weekTotal === 0 ? 'æœ€è¿‘ 7 å¤©æš‚æ— è®°å½•ã€‚' : `è¿‘ 7 å¤©æ€»æ‘„å…¥ ${weekTotal} kcalï¼Œæ—¥å‡ ${Math.round(weekTotal/7)} kcalã€‚`;
      const risky = state.logs.filter(x => x.risks.includes('é«˜ç³–') || x.risks.includes('é«˜æ²¹')).slice(-1)[0];
      document.getElementById('riskSummary').textContent = risky ? `${risky.date} ${risky.meal}ï¼š${risky.name}ï¼ˆ${risky.risks.join('/')}ï¼‰` : 'æš‚æ— é«˜é£é™©é¤æ¬¡ã€‚';
    }

    function renderProfile() {
      document.getElementById('profileText').textContent = `ç›®æ ‡ï¼š${state.profile.goal} | èº«é«˜ï¼š${state.profile.height}cm | ä½“é‡ï¼š${state.profile.weight}kg | æ´»åŠ¨ï¼š${state.profile.activity}`;
      document.getElementById('pHeight').value = state.profile.height;
      document.getElementById('pWeight').value = state.profile.weight;
      document.getElementById('pGoal').value = state.profile.goal;
      document.getElementById('pActive').value = state.profile.activity;
    }

    function toggleProfileForm() { document.getElementById('profileForm').classList.toggle('hidden'); }
    function saveProfile() {
      state.profile.height = Number(document.getElementById('pHeight').value || state.profile.height);
      state.profile.weight = Number(document.getElementById('pWeight').value || state.profile.weight);
      state.profile.goal = document.getElementById('pGoal').value;
      state.profile.activity = document.getElementById('pActive').value;
      state.profile.dailyGoal = state.profile.goal === 'å‡è„‚' ? 1800 : state.profile.goal === 'ç»´æŒ' ? 2200 : 2600;
      saveState(); renderProfile(); renderHome();
      document.getElementById('profileForm').classList.add('hidden');
    }

    function riskTagsFor(rangeMax, desc='') {
      const tags = [];
      if (rangeMax > 780 || /ç‚¸|å¥¶èŒ¶|ç”œ|é…±/.test(desc)) tags.push('é«˜æ²¹');
      if (/å¥¶èŒ¶|ç”œ|å¯ä¹|è›‹ç³•/.test(desc) || rangeMax > 760) tags.push('é«˜ç³–');
      if (/å¤|æ³¡é¢|è…Œ/.test(desc)) tags.push('é«˜é’ ');
      if (!tags.length) tags.push('å‡è¡¡');
      return tags.slice(0, 2);
    }

    function startRecognition() {
      const file = document.getElementById('photo').files[0];
      const desc = document.getElementById('mealDesc').value.trim();
      const [baseMin, baseMax] = mealBase[state.selectedMeal];
      const adjust = Math.max(-80, Math.min(120, desc.length * 4));
      const min = baseMin + adjust;
      const max = baseMax + adjust;
      const risks = riskTagsFor(max, desc);
      state.currentResult = {
        meal: state.selectedMeal,
        name: desc || `${state.selectedMeal}å¤–å–é¤`,
        calorieMin: min,
        calorieMax: max,
        calorieMid: Math.round((min + max) / 2),
        risks
      };
      document.getElementById('resultCalorie').textContent = `${min} - ${max} kcal`;
      document.getElementById('riskTags').innerHTML = risks.map(r => `<span class="pill ${r==='å‡è¡¡'?'ok':r==='é«˜é’ '?'warn':'danger'}">${r}</span>`).join('');
      document.getElementById('resultBreakdown').textContent = `ä¸»è¦æ¥æºï¼šä¸»é£Ÿ ${32 + Math.floor(Math.random()*10)}% / æ²¹è„‚ ${20 + Math.floor(Math.random()*15)}% / è›‹ç™½ ${20 + Math.floor(Math.random()*15)}% / é¥®æ–™ ${5 + Math.floor(Math.random()*10)}%`;
      shuffleAdvice();

      const modal = document.getElementById('modal');
      modal.classList.add('show');
      document.getElementById('loadingText').textContent = file ? `å·²è¯»å– ${file.name}ï¼Œæ­£åœ¨è¯„ä¼°çƒ­é‡å’Œé£é™©...` : `ä½¿ç”¨ã€Œ${state.selectedMeal}ã€ç¤ºä¾‹é¤è¿›è¡Œæ¼”ç¤ºè¯†åˆ«...`;
      setTimeout(() => { modal.classList.remove('show'); showScreen('result'); }, 1200);
    }

    function shuffleAdvice() {
      const [a1, a2] = adviceSet[Math.floor(Math.random() * adviceSet.length)];
      document.getElementById('advice1').textContent = a1;
      document.getElementById('advice2').textContent = a2;
    }

    function saveLog() {
      if (!state.currentResult) return;
      state.logs.push({ ...state.currentResult, date: todayStr(), ts: Date.now() });
      saveState();
      document.getElementById('mealDesc').value = '';
      document.getElementById('photo').value = '';
      renderHome();
      showScreen('home');
    }

    document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', () => showScreen(tab.dataset.target)));
    document.querySelectorAll('#mealSeg button').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('#mealSeg button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.selectedMeal = btn.dataset.meal;
        document.getElementById('uploadMeta').textContent = `å½“å‰ä»¥ã€Œ${state.selectedMeal}ã€ç­–ç•¥ç”Ÿæˆå»ºè®®ã€‚`;
      });
    });

    loadState();
    renderHome();
    renderAnalysis();
    renderProfile();
    shuffleAdvice();
  </script>
</body>
</html>
